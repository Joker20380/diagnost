{% extends 'diagnost/base.html' %}

{% block description %}
Contact AI-Diagnostics — automotive diagnostics, inspection and consultation. Get in touch with our team.
{% endblock %}


{% block title %}Contacts{% endblock %}

{% block content %}
<div class="top-shadow"></div>

<div class="inner-page">
  <div class="slider-item" style="background-image: url('{% static 'images/industrial_hero_3.jpg' %}');">
    <div class="container">
      <div class="row slider-text align-items-center justify-content-center">
        <div class="col-md-8 text-center col-sm-12 element-animate pt-5">
          <h1 class="pt-5"><span>Contacts</span></h1>
          <p class="mb-5 w-75">Feel free to get in touch with us</p>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Contact Form -->
<section class="section">
  <div class="container">
    <div class="row">

      <!-- Form -->
      <div class="col-md-6 mb-5 order-2">
        <form method="post" id="contact_form">
          {% csrf_token %}

          <div class="row">
            <div class="col-md-6 form-group">
              <label for="contact_form_name">Name</label>
              <input
                type="text"
                id="contact_form_name"
                name="name"
                class="form-control"
                placeholder="Your name"
                required>
            </div>

            <div class="col-md-6 form-group">
              <label for="contact_form_phone">Phone</label>
              <input
                type="tel"
                id="contact_form_phone"
                name="phone"
                class="form-control"
                placeholder="Your phone number">
            </div>
          </div>

          <div class="row">
            <div class="col-md-12 form-group">
              <label for="contact_form_email">Email</label>
              <input
                type="email"
                id="contact_form_email"
                name="email"
                class="form-control"
                placeholder="Your email address"
                required>
            </div>
          </div>

          <div class="contact_form_text mt-3">
            <select
              id="contact_form_contact"
              name="contact"
              class="form-control"
              style="width: 100%;">
              <option value="">Select recipient (optional)</option>

              {% if main_contact %}
                <option value="{{ main_contact.id }}">
                  Main contact ({{ main_contact.name }})
                </option>
              {% endif %}

              {% for group in contact_groups %}
                {% for contact in group.contacts.all %}
                  <option value="{{ contact.id }}">
                    {{ group.name }}: {{ contact.name }}
                  </option>
                {% endfor %}
              {% endfor %}
            </select>
          </div>

          <div class="row mt-3">
            <div class="col-md-12 form-group">
              <label for="contact_form_message">Message</label>
              <textarea
                id="contact_form_message"
                name="message"
                class="form-control"
                rows="4"
                placeholder="Write your message here"
                required></textarea>
            </div>
          </div>

          <div class="row">
            <div class="col-md-6 form-group">
              <input
                type="submit"
                value="Send message"
                class="btn btn-primary px-3 py-3">
            </div>
          </div>
        </form>
      </div>

      <!-- Contact info -->
      {% if main_contact %}
      <div class="col-md-6 order-2 mb-5">
        <div class="row justify-content-right">
          <div class="col-md-8 mx-auto contact-form-contact-info">

            {% if main_contact.address %}
            <p class="d-flex">
              <span class="ion-ios-location icon mr-5"></span>
              <span>{{ main_contact.address }}</span>
            </p>
            {% endif %}

            {% if main_contact.phone %}
            <p class="d-flex">
              <span class="ion-ios-telephone icon mr-5"></span>
              <span>{{ main_contact.phone }}</span>
            </p>
            {% endif %}

            {% if main_contact.email %}
            <p class="d-flex">
              <span class="ion-android-mail icon mr-5"></span>
              <span>{{ main_contact.email }}</span>
            </p>
            {% endif %}

          </div>
        </div>
      </div>
      {% endif %}

    </div>
  </div>
</section>

<!-- Map (optional, disabled safely if no coords) -->
{% if location_lat and location_lon %}
<div id="geomap" style="height: 420px; margin-top: 40px;"></div>

<script>
  const map = L.map('geomap').setView(
    [{{ location_lat }}, {{ location_lon }}],
    16
  );

  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution: '© OpenStreetMap contributors'
  }).addTo(map);

  const markerIcon = L.icon({
    iconUrl: "{% static 'images/logo_autozvuk.webp' %}",
    iconSize: [40, 40],
    iconAnchor: [20, 40],
  });

  L.marker(
    [{{ location_lat }}, {{ location_lon }}],
    { icon: markerIcon }
  )
  .addTo(map)
  .bindPopup(
    "<strong>{{ location_name|escapejs }}</strong><br>Service location"
  );
</script>
{% endif %}

{% endblock %}
